# 3D迷路ゲーム 要件定義書

## プロジェクト概要
- **プロジェクト名**: 3D Maze Game
- **種類**: ファーストパーソン3D迷路ゲーム（RPG地下ダンジョン風）
- **プラットフォーム**: Webアプリケーション（スマートフォン最適化）
- **技術**: Three.js + HTML5 + CSS3 + JavaScript

## ゲーム概要
プレイヤーはファーストパーソン視点でRPG風の地下ダンジョンを探索し、鍵を取得してから出口に到達するゲーム。コリドー（通路）ベースの迷路構造で、石造りの壁と床で構成されたダンジョン風の雰囲気を提供する。

## 機能要件

### 基本機能
1. **3D迷路の表示**
   - ファーストパーソン視点
   - リアルタイムレンダリング
   - 滑らかな移動アニメーション
   - ランダム迷路生成

2. **プレイヤー操作**
   - スマートフォンタッチ操作
   - 仮想ジョイスティック（移動）
   - タッチドラッグ（視点変更）
   - スワイプ操作

3. **ゲーム要素**
   - 鍵の配置と取得
   - 出口の配置
   - 鍵取得後の出口開放
   - ゴール到達判定

4. **UI要素**
   - スマートフォン向けレイアウト
   - 操作パネル
   - ゲーム状態表示
   - レスポンシブデザイン

5. **ミニマップ機能**
   - 左上に配置されたミニマップ
   - 初期状態は空白（未探索状態）
   - プレイヤーの移動に応じて探索済みエリアを表示
   - 現在位置の表示
   - 鍵の位置表示（発見後）
   - 出口の位置表示（発見後）

6. **スコア表示機能**
   - 右上に配置されたスコアパネル
   - 歩数カウンター（リアルタイム更新）
   - 経過時間表示（秒単位）
   - ゲーム開始からの経過時間
   - クリア時の最終スコア表示

### スマートフォン最適化
1. **操作系**
   - 仮想ジョイスティック（左下）
   - 視点操作エリア（画面中央）
   - タッチレスポンスの最適化

2. **画面レイアウト**
   - 縦画面・横画面対応
   - タッチしやすいボタンサイズ
   - フルスクリーン表示対応
   - UI要素の配置最適化：
     - ミニマップ（左上）
     - スコアパネル（右上）
     - 操作パネル（左下）

3. **パフォーマンス**
   - 軽量化された3Dモデル
   - モバイルGPU最適化
   - バッテリー消費の考慮

## 技術要件

### 使用技術
- **Three.js**: 3Dレンダリング
- **HTML5**: マークアップ
- **CSS3**: スタイリング・レスポンシブデザイン
- **JavaScript (ES6+)**: ゲームロジック

### 対応ブラウザ
- Chrome (Android)
- Safari (iOS)
- Firefox (Android)
- Edge (Android)

### パフォーマンス要件
- 60FPSでの滑らかな動作
- モバイル端末での安定動作
- ロード時間3秒以内

## ゲームデザイン

### 迷路仕様
- **サイズ**: 20x20（幅x奥行、2Dベースのコリドー構造）
- **壁の高さ**: 2.5ユニット
- **床の材質**: 石畳風（石の境界線付き）
- **壁の材質**: 石造り風（石のテクスチャパターン）
- **生成方式**: ランダム生成（毎回異なる迷路）
- **構造**: コリドー（通路）ベースの2D迷路を3Dで表現

### ゲーム要素
- **鍵**: 金色の鍵（1個）- 石の台座に配置、光る効果付き
- **出口**: ダンジョン風の扉 - 木製扉に石の枠、金色の取っ手付き
- **開始地点**: 迷路の入り口 - 固定位置（1,0,1）

### ダンジョン風デザイン要素
- **石造りの壁**: 暗い石の色（#4a4a4a）とテクスチャパターン
- **石畳の床**: 石の境界線付きの床パターン
- **ダンジョン風ライティング**: 暗い環境光と暖色系照明
- **扉の装飾**: 木製扉に石の枠、金色の取っ手、装飾模様
- **鍵の台座**: 石の台座に金色の鍵、光る効果
- **背景色**: 暗いダンジョン色（#1a1a1a）

### 操作仕様
- **移動**: 仮想ジョイスティック
   - 上→前進
   - 下→後退
   - 右→右を向く
   - 左→左を向く
- **移動速度**: 適度な速度

### ミニマップ仕様
- **サイズ**: 画面の20%程度（左上角）
- **表示方式**: 2Dトップダウン表示
- **色分け**:
  - 未探索エリア: 透明/グレー
  - 探索済みエリア: 薄い青色
  - 壁: 濃いグレー
  - 現在位置: 赤い点
  - 鍵: 金色の点（発見後）
  - 出口: 緑色の点（発見後）
- **更新**: リアルタイム更新
- **スケール**: 迷路全体を表示可能な縮尺

### スコア表示仕様
- **配置**: 右上角（画面の15%程度のサイズ）
- **表示項目**:
  - 歩数カウンター: "歩数: XXX"
  - 経過時間: "時間: XX:XX"（分:秒形式）
- **更新頻度**: リアルタイム更新
- **デザイン**: 半透明の背景で視認性を確保
- **フォント**: 読みやすいサイズと色
- **クリア時**: 最終スコアを大きく表示

### ランダム迷路生成仕様
- **アルゴリズム**: Recursive Backtracking（再帰的バックトラッキング）
- **生成時間**: 3秒以内
- **迷路の特性**: 
  - 必ず解が存在する（開始地点から鍵、鍵から出口まで到達可能）
  - ループなし（単一パス）
  - 適度な複雑さ（簡単すぎず難しすぎない）
  - 2Dベースのコリドー構造
- **要素の配置**:
  - 鍵: 開始地点から離れた場所にランダム配置
  - 出口: 鍵から離れた場所にランダム配置
  - 開始地点: 鍵から離れた場所にランダム配置

## 開発フェーズ

### Phase 1: 基本3D環境構築 ✅完了
- Three.js環境セットアップ
- ランダム迷路生成アルゴリズム実装（2Dベース）
- カメラ制御

### Phase 2: ゲームロジック実装 ✅完了
- プレイヤー移動（2Dベース）
- 鍵取得システム
- ゴール判定
- ミニマップ基本機能
- スコアシステム実装

### Phase 3: スマートフォン最適化 ✅完了
- タッチ操作実装
- UI最適化
- レスポンシブデザイン

### Phase 4: RPGダンジョン風デザイン ✅完了
- 石造りの壁と床の実装
- ダンジョン風ライティング
- 扉と鍵の装飾
- コリドーベース構造への変更

### Phase 5: テスト・動作確認 ✅完了
- パフォーマンス調整
- バグ修正
- 動作テスト完了

## ファイル構成
```
Maze/
├── index.html          # メインHTMLファイル
├── css/
│   └── style.css       # スタイルシート
├── js/
│   ├── main.js         # メインゲームロジック
│   ├── maze.js         # ランダム迷路生成・管理
│   ├── player.js       # プレイヤー制御
│   ├── controls.js     # 操作制御
│   ├── minimap.js      # ミニマップ制御
│   ├── score.js        # スコア管理
│   └── ui.js          # UI制御
├── assets/
│   └── textures/       # テクスチャファイル
└── requirements.md     # このファイル
```

## 成功基準 ✅全て達成
1. ✅ スマートフォンで滑らかに動作する
2. ✅ 直感的な操作が可能
3. ✅ 3D迷路が適切に表示される（コリドーベース構造）
4. ✅ 鍵取得→出口到達の流れが正常に動作する
5. ✅ 複数の画面サイズに対応する
6. ✅ ミニマップがリアルタイムで更新される
7. ✅ 探索済みエリアが適切に記録・表示される
8. ✅ 毎回異なるランダム迷路が生成される
9. ✅ 迷路生成時間が3秒以内に完了する
10. ✅ 歩数と経過時間が正確に表示される
11. ✅ スコア表示がゲーム進行に干渉しない
12. ✅ RPGダンジョン風の雰囲気が実現されている
13. ✅ コリドーベースの迷路構造が動作している
14. ✅ ダンジョン風の装飾要素が適切に表示されている

## 実装状況
- **開発完了**: 全機能が実装済み
- **動作確認**: ゲームプレイテスト完了
- **パフォーマンス**: スマートフォンで安定動作
- **UI/UX**: 直感的な操作が可能
- **デザイン**: RPGダンジョン風の雰囲気を実現

---
作成日: 2024年
最終更新: 2024年
バージョン: 2.0（RPGダンジョン風・コリドーベース構造対応版）

## 更新履歴
- **v1.0**: 初期版（3D立方体構造）
- **v2.0**: RPGダンジョン風デザイン、コリドーベース構造、20x20迷路サイズ対応
